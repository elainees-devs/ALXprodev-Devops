#!/bin/bash

# Define paths
DATA_DIR="pokemon_data"
CSV_FILE="pokemon_report.csv"

# Create or clear the CSV file and add header
echo "Name, Height (m), Weight (kg)" > "CSV_FILE"

# Loop through each JSON file and extract data
for file in "$DATA_DIR"/*.json; do
  name=$(jq -r '.name' "$file" | sed 's/.*/\u&/')
  height=$(jq '.height' "$file" | awk '{printf "%.1f", $1 / 10}')
  weight=$(jq '.weight' "$file" | awk '{printf "%.1f", $1 /10}')

  echo "$name, $height, $weight" >> "CSV_FILE"
done

# Display success message
echo "CSV Report generated at: $CSV_FILE"
echo ""

# Print contents
cat "$CSV_FILE"

# Calculate and print averages using awk (skip header)
awk -F',' 'NR > 1 {h += $2; w += $3; n++} 
  END {
    printf "\nAverage Height: %.2f m\n", h/n
    printf "Average Weight: %.2f kg\n", w/n
  }'
